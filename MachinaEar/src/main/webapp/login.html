<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Sign In - MachinaEar</title>
		<link rel="stylesheet" href="css/styles.css" />
		<!-- ALTCHA Widget (hosted locally to avoid CSP issues) -->
		<script async defer src="js/altcha.min.js" type="module"></script>
		<style>
			/* ALTCHA Widget Styling */
			altcha-widget {
				--altcha-max-width: 100%;
				margin: 1rem 0;
			}
			.altcha-container {
				margin: 1rem 0;
			}
		</style>
	</head>
	<body>
		<div class="card">
			<h1 id="formTitle" class="title">Sign In</h1>
			<p id="formSubtitle" class="subtitle">Enter your credentials to continue</p>

			<!-- Alerts -->
			<div id="errorAlert" class="alert alert-error hidden"></div>
			<div id="infoAlert" class="alert alert-info hidden"></div>
			<div id="successAlert" class="alert alert-success hidden"></div>

			<!-- Login Form -->
			<form id="loginForm" class="mt-6 space-y-4">
				<div class="form-group">
					<label for="loginEmail">Email Address</label>
					<input type="email" id="loginEmail" name="email" class="input" required autocomplete="email" placeholder="you@example.com" />
				</div>

				<div class="form-group">
					<label for="loginPassword">Password</label>
					<input type="password" id="loginPassword" name="password" class="input" required autocomplete="current-password" placeholder="••••••••" />
				</div>

				<div class="toggle-link">
					<a id="toggle2FALink" class="link">I have a 2FA code</a>
					<a id="forgotPasswordLink" class="link">Forgot password?</a>
				</div>

				<!-- 2FA Section (collapsible) -->
				<div id="twoFactorSection" class="section-collapsible">
					<div class="form-group">
						<label for="totpCode">Two-Factor Authentication Code</label>
						<input type="text" id="totpCode" name="totpCode" class="input" maxlength="6" pattern="[0-9]{6}" placeholder="000000" inputmode="numeric" autocomplete="one-time-code" />
						<span class="helper-text">Enter the 6-digit code from your authenticator app</span>
					</div>

					<div class="form-group">
						<label for="recoveryCode">Or use Recovery Code</label>
						<input type="text" id="recoveryCode" name="recoveryCode" class="input font-mono" placeholder="XXXX-XXXX-XXXX" autocomplete="off" />
						<span class="helper-text">Use a recovery code if you can't access your authenticator</span>
					</div>
				</div>

				<!-- ALTCHA Anti-Automation Challenge -->
				<div class="altcha-container">
					<altcha-widget id="loginAltcha" challengeurl="" hidelogo hidefooter workers="0"> </altcha-widget>
				</div>

				<button type="submit" id="loginBtn" class="btn btn-primary">Sign In</button>

				<div class="form-footer">
					Don't have an account?
					<a class="link" data-action="show-register">Sign up</a>
				</div>
			</form>

			<!-- Register Form -->
			<form id="registerForm" class="mt-6 space-y-4 hidden">
				<div class="form-group">
					<label for="registerEmail">Email Address</label>
					<input type="email" id="registerEmail" name="email" class="input" required autocomplete="email" placeholder="you@example.com" />
				</div>

				<div class="form-group">
					<label for="registerUsername">Username</label>
					<input type="text" id="registerUsername" name="username" class="input" required autocomplete="username" minlength="3" placeholder="johndoe" />
				</div>

				<div class="form-group">
					<label for="registerPassword">Password</label>
					<input type="password" id="registerPassword" name="password" class="input" required autocomplete="new-password" minlength="8" placeholder="••••••••" />
					<div id="passwordStrength" class="password-strength hidden">
						<div class="password-strength-bar">
							<div id="strengthFill" class="password-strength-fill"></div>
						</div>
						<span id="strengthLabel" class="strength-label"></span>
					</div>
				</div>

				<div class="form-group">
					<label for="confirmPassword">Confirm Password</label>
					<input type="password" id="confirmPassword" name="confirmPassword" class="input" required autocomplete="new-password" placeholder="••••••••" />
				</div>

				<!-- ALTCHA Anti-Automation Challenge -->
				<div class="altcha-container">
					<altcha-widget id="registerAltcha" challengeurl="" hidelogo hidefooter workers="0"> </altcha-widget>
				</div>

				<button type="submit" id="registerBtn" class="btn btn-primary">Create Account</button>

				<div class="form-footer">
					Already have an account?
					<a class="link" data-action="show-login">Sign in</a>
				</div>
			</form>

			<!-- Forgot Password Form -->
			<form id="forgotPasswordForm" class="mt-6 space-y-4 hidden">
				<div class="form-group">
					<label for="forgotEmail">Email Address</label>
					<input type="email" id="forgotEmail" name="email" class="input" required autocomplete="email" placeholder="you@example.com" />
					<span class="helper-text">We'll send you a link to reset your password</span>
				</div>

				<button type="submit" id="forgotPasswordBtn" class="btn btn-primary">Send Reset Link</button>

				<div class="form-footer">
					Remember your password?
					<a class="link" data-action="show-login">Sign in</a>
				</div>
			</form>

			<!-- Email Verification Page (for token-based verification) -->
			<div id="verifyEmailPage" class="mt-6 space-y-4 hidden">
				<div class="verification-icon">✉️</div>
				<p id="verifyEmailMessage" class="text-center">Verifying your email...</p>
				<button id="verifyEmailBackBtn" class="btn btn-secondary">Back to Sign In</button>
			</div>

			<!-- Email Verification Code Form (for 6-digit code verification) -->
			<form id="verifyCodeForm" class="mt-6 space-y-4 hidden">
				<div class="verification-icon">✉️</div>
				<p id="verifyCodeEmail" class="text-center email-display"></p>
				
				<div class="form-group">
					<label for="verificationCode">Verification Code</label>
					<input type="text" id="verificationCode" name="verificationCode" class="input verification-code-input" 
						maxlength="6" pattern="[0-9]{6}" placeholder="000000" 
						inputmode="numeric" autocomplete="one-time-code" required />
					<span class="helper-text">Enter the 6-digit code sent to your email</span>
				</div>

				<button type="submit" id="verifyCodeBtn" class="btn btn-primary">Verify Code</button>
				
				<div class="form-footer">
					<span>Didn't receive the code?</span>
					<button type="button" id="resendCodeBtn" class="link btn-link">Resend Code</button>
				</div>

				<div class="form-footer">
					<a class="link" data-action="show-register">Start Over</a>
				</div>
			</form>

			<!-- Reset Password Form -->
			<form id="resetPasswordForm" class="mt-6 space-y-4 hidden">
				<div class="form-group">
					<label for="newPassword">New Password</label>
					<input type="password" id="newPassword" name="newPassword" class="input" required autocomplete="new-password" minlength="8" placeholder="••••••••" />
					<div id="resetPasswordStrength" class="password-strength hidden">
						<div class="password-strength-bar">
							<div id="resetStrengthFill" class="password-strength-fill"></div>
						</div>
						<span id="resetStrengthLabel" class="strength-label"></span>
					</div>
				</div>

				<div class="form-group">
					<label for="confirmNewPassword">Confirm New Password</label>
					<input type="password" id="confirmNewPassword" name="confirmNewPassword" class="input" required autocomplete="new-password" placeholder="••••••••" />
				</div>

				<button type="submit" id="resetPasswordBtn" class="btn btn-primary">Reset Password</button>

				<div class="form-footer">
					Remember your password?
					<a class="link" data-action="show-login">Sign in</a>
				</div>
			</form>
		</div>

		<script src="js/login.js"></script>
	</body>
</html>
